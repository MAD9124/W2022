(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{307:function(t,e,s){t.exports=s.p+"assets/img/aws-classroom-setup15.5f332920.png"},442:function(t,e,s){t.exports=s.p+"assets/img/aws-classroom-setup17.1f2e361b.png"},515:function(t,e,s){"use strict";s.r(e);var a=s(42),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"aws-ecs-with-docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aws-ecs-with-docker-compose"}},[t._v("#")]),t._v(" AWS ECS with Docker Compose")]),t._v(" "),a("h3",{attrs:{id:"set-aws-access-keys"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#set-aws-access-keys"}},[t._v("#")]),t._v(" Set AWS Access Keys")]),t._v(" "),a("p",[t._v("Set up the local config and credentials files for AWS CLI access.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("mkdir ~/.aws\ntouch ~/.aws/config\ntouch ~/.aws/credentials\n")])])]),a("p",[t._v("Copy this text into the "),a("code",[t._v("config")]),t._v(" file.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[default]\noutput = json\nregion = us-east-1\n")])])]),a("p",[t._v("Get you AWS Classroom account credentials.\n"),a("img",{attrs:{src:s(307),alt:"AWS account summary"}})]),t._v(" "),a("p",[t._v("Click the "),a("code",[t._v("account details")]),t._v(" button and then on the next screen, click the "),a("code",[t._v("show")]),t._v(" button.")]),t._v(" "),a("p",[a("img",{attrs:{src:s(442),alt:"AWS account details"}})]),t._v(" "),a("p",[t._v("Copy the displayed content and paste it into the "),a("code",[t._v("~/.aws/credentials")]),t._v(" file. It will look something like this ...")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[default]\naws_access_key_id=<YOUR_ACCESS_KEY>\naws_secret_access_key=<YOUR_SECRET_KEY>\naws_session_token=<A_VERY_LONG_STRING>\n")])])]),a("h3",{attrs:{id:"create-a-docker-context"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-a-docker-context"}},[t._v("#")]),t._v(" Create a Docker Context")]),t._v(" "),a("p",[t._v("Docker uses context profiles to know where to launch new container instances. The "),a("code",[t._v("default")]),t._v(" context points to your local machine. Using the "),a("code",[t._v("docker context create ecs")]),t._v(" command, you can create a new one that will point to your AWS Classroom account. The command will prompt you with two questions. Choose "),a("code",[t._v("An existing AWS profile")]),t._v(" and "),a("code",[t._v("default")]),t._v(" respectively.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('docker context create ecs mad9124\n? Create a Docker context using: An existing AWS profile\n? Select AWS Profile default\nSuccessfully created ecs context "mad9124"\n')])])]),a("p",[t._v("Verify your settings by running the "),a("code",[t._v("docker context ls")]),t._v(" command.")]),t._v(" "),a("p",[t._v('Switch the active Docker context to your new "mad9124" profile.')]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker context use mad9124\n")])])]),a("p",[t._v("Create a "),a("code",[t._v("docker-compose.yml")]),t._v(" file.")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.8'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("express")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <YOUR_DOCKER_HUB_USER_NAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("/giftr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("w21\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" giftr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("w21\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("API_JWTKEY")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" esftq9gj691gw18dmn2myul1nz9hqy\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("API_PORT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NODE_ENV")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'stage'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token datetime number"}},[t._v("80:80")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" node server.js\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deploy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("x-aws-autoscaling")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("min")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("70")]),t._v("\n")])])]),a("p",[t._v("Deploy your application to AWS.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker compose up -d\n")])])]),a("p",[t._v("It will take a few minutes to create the virtual network and spin-up your containers. Check on the deployment progress:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker compose ps\n")])])]),a("p",[t._v("When it is running, you will see the URL for the load-balancer displayed in the output.")])])}),[],!1,null,null,null);e.default=n.exports}}]);