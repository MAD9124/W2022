<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Week 5: Data persistence | MAD9124</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Full Stack: API Development">
    
    <link rel="preload" href="/W2022/assets/css/0.styles.7a32498c.css" as="style"><link rel="preload" href="/W2022/assets/js/app.cec51691.js" as="script"><link rel="preload" href="/W2022/assets/js/3.9c2ff4f7.js" as="script"><link rel="preload" href="/W2022/assets/js/9.665b29a5.js" as="script"><link rel="preload" href="/W2022/assets/js/11.f11acbbb.js" as="script"><link rel="preload" href="/W2022/assets/js/16.1ec56656.js" as="script"><link rel="prefetch" href="/W2022/assets/js/10.31dfe672.js"><link rel="prefetch" href="/W2022/assets/js/12.96649c49.js"><link rel="prefetch" href="/W2022/assets/js/13.535bc82d.js"><link rel="prefetch" href="/W2022/assets/js/14.028cb9d2.js"><link rel="prefetch" href="/W2022/assets/js/15.ced8bd8c.js"><link rel="prefetch" href="/W2022/assets/js/17.a48a571a.js"><link rel="prefetch" href="/W2022/assets/js/18.1528acad.js"><link rel="prefetch" href="/W2022/assets/js/19.61d8cc80.js"><link rel="prefetch" href="/W2022/assets/js/2.b4d63df3.js"><link rel="prefetch" href="/W2022/assets/js/20.4071399f.js"><link rel="prefetch" href="/W2022/assets/js/21.e5b3b049.js"><link rel="prefetch" href="/W2022/assets/js/22.8b4aae43.js"><link rel="prefetch" href="/W2022/assets/js/23.61c52980.js"><link rel="prefetch" href="/W2022/assets/js/24.55bc8f66.js"><link rel="prefetch" href="/W2022/assets/js/25.4ac50e54.js"><link rel="prefetch" href="/W2022/assets/js/26.9ce0e977.js"><link rel="prefetch" href="/W2022/assets/js/27.3a9bd92a.js"><link rel="prefetch" href="/W2022/assets/js/28.06fd6a07.js"><link rel="prefetch" href="/W2022/assets/js/29.1bb95a0c.js"><link rel="prefetch" href="/W2022/assets/js/30.dae4692c.js"><link rel="prefetch" href="/W2022/assets/js/31.8fbfd6d3.js"><link rel="prefetch" href="/W2022/assets/js/32.68c3574f.js"><link rel="prefetch" href="/W2022/assets/js/33.617cdd3b.js"><link rel="prefetch" href="/W2022/assets/js/34.e9d21a2b.js"><link rel="prefetch" href="/W2022/assets/js/35.6e9bfe39.js"><link rel="prefetch" href="/W2022/assets/js/36.d4810b3d.js"><link rel="prefetch" href="/W2022/assets/js/37.8f7eb267.js"><link rel="prefetch" href="/W2022/assets/js/38.23784716.js"><link rel="prefetch" href="/W2022/assets/js/39.2e9e7983.js"><link rel="prefetch" href="/W2022/assets/js/4.a3d079e3.js"><link rel="prefetch" href="/W2022/assets/js/40.7f13d575.js"><link rel="prefetch" href="/W2022/assets/js/5.3200619b.js"><link rel="prefetch" href="/W2022/assets/js/6.4a9ec533.js"><link rel="prefetch" href="/W2022/assets/js/7.f496cd23.js"><link rel="prefetch" href="/W2022/assets/js/8.0225588a.js">
    <link rel="stylesheet" href="/W2022/assets/css/0.styles.7a32498c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/W2022/" class="home-link router-link-active"><!----> <span class="site-name">MAD9124</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/W2022/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/W2022/modules/" class="nav-link router-link-active">
  Modules
</a></div><div class="nav-item"><a href="/W2022/deliverables/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/W2022/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/W2022/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/W2022/modules/" class="nav-link router-link-active">
  Modules
</a></div><div class="nav-item"><a href="/W2022/deliverables/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/W2022/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deliverables</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Content Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/W2022/modules/" aria-current="page" class="sidebar-link">Table of contents</a></li><li><a href="/W2022/modules/week1/" class="sidebar-link">Week 1: Introduction &amp; Review</a></li><li><a href="/W2022/modules/week2/" class="sidebar-link">Week 2: Node Modules &amp; Express</a></li><li><a href="/W2022/modules/week3/" class="sidebar-link">Week 3: RESTful APIs</a></li><li><a href="/W2022/modules/week4/" class="sidebar-link">Week 4: Middleware functions</a></li><li><a href="/W2022/modules/week5/" aria-current="page" class="active sidebar-link">Week 5: Data persistence</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#agenda" class="sidebar-link">Agenda</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#file-system" class="sidebar-link">File system</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#synchronize-cars-json" class="sidebar-link">Synchronize cars.json</a></li></ul></li><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#databases" class="sidebar-link">Databases</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#relational-databases" class="sidebar-link">Relational Databases</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#document-databases" class="sidebar-link">Document Databases</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#relational-db-v-s-document-db" class="sidebar-link">Relational DB v.s. Document DB</a></li></ul></li><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#schema" class="sidebar-link">Schema</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#sql" class="sidebar-link">SQL</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#mongodb" class="sidebar-link">MongoDB</a></li></ul></li><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#hands-on-with-mongodb" class="sidebar-link">Hands on with MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#install-mongodb" class="sidebar-link">Install MongoDB</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#install-mongodb-compass" class="sidebar-link">Install MongoDB Compass</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#running-mongodb-locally" class="sidebar-link">Running MongoDB locally</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#connect-to-mongodb-from-node-js" class="sidebar-link">Connect to MongoDB from Node.js</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#mongoose-quick-start" class="sidebar-link">Mongoose Quick Start</a></li></ul></li><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#ex5-set-up-mongodb" class="sidebar-link">EX5 Set-up MongoDB</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week5/#for-next-week" class="sidebar-link">For next week</a></li></ul></li><li><a href="/W2022/modules/week6/" class="sidebar-link">Week 6: Object Data Modelling</a></li><li><a href="/W2022/modules/week7/" class="sidebar-link">Week 7: Data security</a></li><li><a href="/W2022/modules/break-week/" class="sidebar-link">Break Week</a></li><li><a href="/W2022/modules/week9/" class="sidebar-link">Week 9: Access Control with JWT</a></li><li><a href="/W2022/modules/week10/" class="sidebar-link">Week 10: JWT Review</a></li><li><a href="/W2022/modules/week11/" class="sidebar-link">Week 11: Consistent Error Handling</a></li><li><a href="/W2022/modules/week12/" class="sidebar-link">Week 12: Production Preparation</a></li><li><a href="/W2022/modules/week13/" class="sidebar-link">Week 13: Testing</a></li><li><a href="/W2022/modules/week14/" class="sidebar-link">Week 14: Production Deployment</a></li><li><a href="/W2022/modules/week15/" class="sidebar-link">Week 15: Final Lab</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1><span class="week">Week 5</span><br> <span class="title">Data persistence and intro to MongoDB</span></h1> <div class="custom-block danger"><p class="custom-block-title">Assignment Due</p> <p>Assignment 1 - Basic CRUD - is due <strong>before</strong> 6:00 pm on Wednesday, February 9th.<br>
It is worth 10% of your final grade.</p></div> <div class="custom-block danger"><p class="custom-block-title">Quiz 4: Middleware <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>15 mins</span></p> <p>There will be a quiz today. It will be worth 2% of your final grade.</p></div> <h2 id="agenda"><a href="#agenda" class="header-anchor">#</a> Agenda</h2> <ul><li>AMA (10 min)</li> <li>Quiz (10 min)</li> <li>EX5-1 File system (15 min)</li> <li>Relational Databases v.s. Document Databases (20 min)</li> <li>Break (10 mins)</li> <li>EX5-2 Install MongoDB &amp; Compass (15 mins)</li> <li>EX5-3 Connect with Mongoose (30 mins)</li></ul> <h2 id="file-system"><a href="#file-system" class="header-anchor">#</a> File system</h2> <p>Data persistence is about saving the last known state of all data elements in our application - also known as the application state. Ultimately, this means saving it to a file on disk somewhere. This could be a local JSON file. It could be a cloud storage service like Amazon's S3 or Google Cloud Storage. More often it is handled by an intermediary database service like MongoDB or PostgreSQL.</p> <h3 id="synchronize-cars-json"><a href="#synchronize-cars-json" class="header-anchor">#</a> Synchronize <code>cars.json</code></h3> <p>We are going to focus mostly on the database scenario for the rest of the course, but let's examine the local JSON file example for just a minute. If you think about the in-class exercise from last week, every time we restarted the application the <code>cars</code> collection reset to the initial four objects loaded from the <code>cars.js</code> file. With just a few extra lines of code, we could ensure that the current state of the application data is saved every time one of the route handlers is called.</p> <h4 id="convert-cars-js-to-cars-json"><a href="#convert-cars-js-to-cars-json" class="header-anchor">#</a> Convert cars.js to cars.json</h4> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;make&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Tesla&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;S&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;colour&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Black&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">&quot;make&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Tesla&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;colour&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Indigo&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">&quot;make&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Tesla&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;X&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;colour&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Brown&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token property">&quot;make&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Tesla&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;model&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Y&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;colour&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Silver&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p>Update the import statements in both <code>routes/cars.js</code> and <code>middleware/validateId.js</code> to load the new JSON file.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> cars <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../data/cars.json'</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="create-new-utility-function"><a href="#create-new-utility-function" class="header-anchor">#</a> Create new utility function</h4> <ol><li><p>In the <code>routes/cars.js</code> module, you will need to import the <a href="https://nodejs.org/api/fs.html#fs_fs_promises_api" target="_blank" rel="noopener noreferrer">fs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> core node module -- <strong>let's use the Promises version</strong>.</p></li> <li><p>Then create a new function called <code>writeJsonData</code> that takes a JavaScript data structure as an argument – in our case it will be an array of objects. The function will open the <code>/data/cars.json</code> file in write mode, and then write out the <code>data</code> argument converted to JSON format.</p></li> <li><p>Wrap the logic in a <code>try/catch</code> block to handle any errors, and ensure the <code>filehandle</code> gets closed by using the <code>finally</code> clause.</p></li></ol> <div class="language-js extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>promises

<span class="token keyword">const</span> <span class="token function-variable function">writeJsonData</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> filehandle
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    filehandle <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../data/cars.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> filehandle<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Problem writing cars.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>filehandle <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">await</span> filehandle<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>Update each of the route hander functions that changes the cars data array (i.e. POST, PUT, PATCH, DELETE) to call <code>writeJsonData(cars)</code> just before the <code>res.send</code> call.</li></ol> <p>Now as the data changes with each HTTP request, the application state (data) is copied to the JSON file, and the next time the server is restarted, it will be reloaded.</p> <h2 id="databases"><a href="#databases" class="header-anchor">#</a> Databases</h2> <p>Most real world applications need to store structured data that reflects the state of the application and is selectively searchable, with appropriate authorization credentials. This is the job of a database.</p> <p>Traditionally databases systems have been based on a series of tables, like a spreadsheet, with the columns representing the properties on a record and each row containing the complete set of properties for that unique record.</p> <p>The cars data we have been working with might be represented in a table like this.</p> <table><thead><tr><th style="text-align:right;">id</th> <th>make</th> <th>model</th> <th>colour</th></tr></thead> <tbody><tr><td style="text-align:right;">1</td> <td>Tesla</td> <td>S</td> <td>Black</td></tr> <tr><td style="text-align:right;">2</td> <td>Tesla</td> <td>3</td> <td>Indigo</td></tr> <tr><td style="text-align:right;">3</td> <td>Tesla</td> <td>X</td> <td>Brown</td></tr> <tr><td style="text-align:right;">4</td> <td>Tesla</td> <td>Y</td> <td>Silver</td></tr></tbody></table> <h3 id="relational-databases"><a href="#relational-databases" class="header-anchor">#</a> Relational Databases</h3> <p>As we build applications that follow an Object Oriented Design, each table maps to a collection of objects of a given class. Often several of these objects will have some relationship to another. For example in a blog application, an Article will have an Author. Article and Author represent two classes of objects and there is a relationship between specific instances of those objects.</p> <p>We have typically solved the storage of this kind of data with <a href="https://www.dummies.com/programming/sql/knowing-just-enough-about-relational-databases/" target="_blank" rel="noopener noreferrer">Relational Databases<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> -- invented be a guy named <a href="https://searchoracle.techtarget.com/definition/E-F-Codd" target="_blank" rel="noopener noreferrer">Ted Codd<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> at IBM back in the early 1970s.</p> <p>The standard API for interacting with a relational database is the <a href="https://en.wikipedia.org/wiki/SQL" target="_blank" rel="noopener noreferrer">Structured Query Language<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (SQL - commonly pronounced <em>seequel</em>). Some of the most common relational database systems are:</p> <ul><li>MySQL / MariaDB</li> <li>PostgreSQL</li> <li>Oracle DB</li> <li>MS SQL Server</li></ul> <h3 id="document-databases"><a href="#document-databases" class="header-anchor">#</a> Document Databases</h3> <p>About 10 years ago, along with the development of Node.js people started wondering if there was a different kind of database model that was a better fit for the rapidly iterating development cycle of the JavaScript world. Many variations on the Document Database model also know as NoSQL Databases came into being. All of them centred on the JSON document or a key/value pair structure as the storage model.</p> <p>The biggest attraction with NoSQL databases is the flexibility. There is no need to predefine a table schema as there is with SQL databases. Some examples of NoSQL databases are:</p> <ul><li>Google Firestore</li> <li>AWS DynamoDB</li> <li>CouchDB</li> <li>MongoDB</li></ul> <h3 id="relational-db-v-s-document-db"><a href="#relational-db-v-s-document-db" class="header-anchor">#</a> Relational DB v.s. Document DB</h3> <h2 id="schema"><a href="#schema" class="header-anchor">#</a> Schema</h2> <p>A database schema, means to define the shape of the data that we want to store. With SQL databases, this must be defined in advance of storing data. With document databases, there is no database imposed schema. If you can put it in a JSON document, you can store it in the database.</p> <p>You will sometimes hear NoSQL databases referred to as schema-less. This does not mean that your application has no structured data model. It just shifts the responsibility for enforcing that structure to the application code rather than the database.</p> <p>Let's look at how we would represent the data for a simple attendance tracking application.</p> <h3 id="sql"><a href="#sql" class="header-anchor">#</a> SQL</h3> <p><img src="/W2022/assets/img/attendance-er-diagram.49c5cde0.png" alt="entity relationship diagram"></p> <h3 id="mongodb"><a href="#mongodb" class="header-anchor">#</a> MongoDB</h3> <h4 id="embedded-data-structures-to-model-relationships"><a href="#embedded-data-structures-to-model-relationships" class="header-anchor">#</a> Embedded data structures to model relationships.</h4> <p>Although there is some benefit to this flexibility for rapid prototyping, there are trade-offs. The biggest one is synchronization of duplicate data. It takes just as much careful planning to build a robust and scalable NoSQL database.</p> <p><strong>Students</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>students<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token number">201800001</span><span class="token punctuation">,</span>
    firstName<span class="token operator">:</span> <span class="token string">'Mickey'</span><span class="token punctuation">,</span>
    lastName<span class="token operator">:</span> <span class="token string">'Mouse'</span><span class="token punctuation">,</span>
    nickName<span class="token operator">:</span> <span class="token string">'Steamboat Willie'</span><span class="token punctuation">,</span>
    email<span class="token operator">:</span> <span class="token string">'mickey.mouse@disney.com'</span><span class="token punctuation">,</span>
    githubId<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    birthDate<span class="token operator">:</span> <span class="token string">'1928-11-18'</span><span class="token punctuation">,</span>
    imageUrl<span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token number">201800002</span><span class="token punctuation">,</span>
    firstName<span class="token operator">:</span> <span class="token string">'Minerva'</span><span class="token punctuation">,</span>
    lastName<span class="token operator">:</span> <span class="token string">'Mouse'</span><span class="token punctuation">,</span>
    nickName<span class="token operator">:</span> <span class="token string">'Minnie'</span><span class="token punctuation">,</span>
    email<span class="token operator">:</span> <span class="token string">'minnie.mouse@disney.com'</span><span class="token punctuation">,</span>
    githubId<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    birthDate<span class="token operator">:</span> <span class="token string">'1928-11-18'</span><span class="token punctuation">,</span>
    imageUrl<span class="token operator">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><p><strong>Courses</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  courses<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      _id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      code<span class="token operator">:</span> <span class="token string">'MAD9124'</span><span class="token punctuation">,</span>
      title<span class="token operator">:</span> <span class="token string">'Mobile API Development'</span><span class="token punctuation">,</span>
      description<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Students enhance their JavaScript skills to become productive with Full-stack development. They use a hands-on approach to build APIs using Node.JS and a variety of tools, frameworks, libraries and packages. The creation of these modern APIs also requires the students to develop skills with persistent scalable database storage systems. Project work culminates with students creating APIs to be used with websites and mobile applications. Students work individually as well as with other students to complete tasks.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      sections<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          _id<span class="token operator">:</span> <span class="token string">'mad9124w19s300'</span><span class="token punctuation">,</span>
          number<span class="token operator">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
          name<span class="token operator">:</span> <span class="token string">'Alpha Team'</span><span class="token punctuation">,</span>
          students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">201800001</span><span class="token punctuation">,</span> <span class="token number">201800002</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          classes<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              _id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
              room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span>
              startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">201800001</span><span class="token punctuation">,</span> <span class="token number">201800002</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              _id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
              room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span>
              startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">201800001</span><span class="token punctuation">,</span> <span class="token number">201800002</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              _id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
              room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span>
              startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">201800001</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              _id<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
              room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span>
              startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">201800001</span><span class="token punctuation">,</span> <span class="token number">201800002</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              _id<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
              room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span>
              startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">201800002</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              _id<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
              room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span>
              startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">201800001</span><span class="token punctuation">,</span> <span class="token number">201800002</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              _id<span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
              room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span>
              startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">201800001</span><span class="token punctuation">,</span> <span class="token number">201800002</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              _id<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
              room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span>
              startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">201800001</span><span class="token punctuation">,</span> <span class="token number">201800002</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              _id<span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
              room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span>
              startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">201800001</span><span class="token punctuation">,</span> <span class="token number">201800002</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              _id<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
              room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span>
              startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">201800001</span><span class="token punctuation">,</span> <span class="token number">201800002</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              _id<span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
              room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span>
              startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">201800001</span><span class="token punctuation">,</span> <span class="token number">201800002</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              _id<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span>
              room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span>
              startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">201800001</span><span class="token punctuation">,</span> <span class="token number">201800002</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              _id<span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>
              room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span>
              startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">201800001</span><span class="token punctuation">,</span> <span class="token number">201800002</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
              _id<span class="token operator">:</span> <span class="token number">14</span><span class="token punctuation">,</span>
              room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span>
              startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
              students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">201800001</span><span class="token punctuation">,</span> <span class="token number">201800002</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          _id<span class="token operator">:</span> <span class="token string">'mad9124w19s301'</span><span class="token punctuation">,</span>
          number<span class="token operator">:</span> <span class="token number">301</span><span class="token punctuation">,</span>
          name<span class="token operator">:</span> <span class="token string">'Bravo Team'</span><span class="token punctuation">,</span>
          students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          classes<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span> room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span> startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span> room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span> startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span> room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span> startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span> room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span> startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span> startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span> room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span> startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">27</span><span class="token punctuation">,</span> room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span> startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span> room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span> startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">,</span> room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span> startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span> startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span> room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span> startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">32</span><span class="token punctuation">,</span> room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span> startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">33</span><span class="token punctuation">,</span> room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span> startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>_id<span class="token operator">:</span> <span class="token number">34</span><span class="token punctuation">,</span> room<span class="token operator">:</span> <span class="token string">'WT127'</span><span class="token punctuation">,</span> startTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> endTime<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> students<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="hands-on-with-mongodb"><a href="#hands-on-with-mongodb" class="header-anchor">#</a> Hands on with MongoDB</h2> <h3 id="install-mongodb"><a href="#install-mongodb" class="header-anchor">#</a> Install MongoDB</h3> <p>There are several ways to get MongoDB running in your local development environment.</p> <ol><li>Download the runtime installer from the MongoDB website.</li> <li>Use Homebrew to install MongoDB.</li> <li>Use Docker and run it in a container.</li></ol> <p>For this course, we will use the Docker container option. This has the benefit of letting us use different versions for different projects and keep the test/development data isolated between projects. You can use a single container for all of our in-class exercises, but I recommend that you create a separate container with it's own data folder inside each of your projects.</p> <p><strong>But, don't forget to shut-down containers that you are not using</strong></p> <div class="custom-block tip"><p class="custom-block-title">If you haven't already ...</p> <p>Create a free <a href="https://hub.docker.com" target="_blank" rel="noopener noreferrer">Docker Hub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> account.<br>
Download <strong>Docker Desktop</strong> and run the installer.</p> <p>If you already have Docker installed, make sure that it is running the latest version.</p></div> <h4 id="docker-compose"><a href="#docker-compose" class="header-anchor">#</a> Docker Compose</h4> <p>Because this will be running only in our development environment, we don't need to worry about complicated security and user authentication set-up. Let's keep it simple.</p> <p>In your code folder for this class (e.g. <code>~/code/mad9124</code>), create a new configuration file called <code>docker-compose.yml</code> with the following content.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">mongo</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mongo<span class="token punctuation">:</span>bionic
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./data/mongo<span class="token punctuation">:</span>/data/db
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">'27017-27019:27017-27019'</span>
</code></pre></div><p>Now using the terminal in the same folder, create the data folder that the mongo container will use.</p> <div class="language- extra-class"><pre class="language-text"><code>mkdir data
mkdir data/mongo
</code></pre></div><p>And then start your local MongoDB server with ...</p> <div class="language- extra-class"><pre class="language-text"><code>docker-compose up -d
</code></pre></div><p>Verify that the MongoDB container is running ...</p> <div class="language- extra-class"><pre class="language-text"><code>docker-compose ps
</code></pre></div><p>You should see something like ...</p> <div class="language- extra-class"><pre class="language-text"><code>    Name                  Command             State                  Ports
------------------------------------------------------------------------------------------
mad9124_mongo_1   docker-entrypoint.sh mongod   Up    0.0.0.0:27017-&gt;27017/tcp,
                                                      0.0.0.0:27018-&gt;27018/tcp,
                                                      0.0.0.0:27019-&gt;27019/tcp
</code></pre></div><p>To shut it down, simply run ...</p> <div class="language- extra-class"><pre class="language-text"><code>docker-compose down
</code></pre></div><h3 id="install-mongodb-compass"><a href="#install-mongodb-compass" class="header-anchor">#</a> Install MongoDB Compass</h3> <p>If you have worked with MySQL databases in the past you probably used a tool like phpMyAdmin, MySQL WorkBench or Sequel PRO to manage and query your databases. MongoDB has a similar tool call Compass. You can read all about its capabilities on at <a href="https://mongodb.com" target="_blank" rel="noopener noreferrer">MongoDB.com<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <img alt="Select Compass from the products menu" src="/W2022/assets/img/screenshot-mongo-software.90e01fd4.png" class="screenshot"> <p>Lets download and install it from the <a href="https://www.mongodb.com/try/download/compass" target="_blank" rel="noopener noreferrer">MongoDB Download Center<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Make sure that you select the latest stable version (currently 1.30.1).</p> <div class="custom-block warning"><p class="custom-block-title">No more community version</p> <p>There used to be a separate (free) community version and the (paid) enterprise version. There is now only one stream and it is free for everyone.</p> <p>If you had the older community version installed, please uninstall it use the latest stable release version instead.</p></div> <p>With the correct version selected, click the big green download button, and then run the DMG installer (the downloaded file).</p> <h3 id="running-mongodb-locally"><a href="#running-mongodb-locally" class="header-anchor">#</a> Running MongoDB locally</h3> <p>To run MongoDB in your local development environment, you need to start the docker container we created earlier. Open the terminal in your project folder and run this command ...</p> <div class="language- extra-class"><pre class="language-text"><code>docker-compose up -d
</code></pre></div><p>This starts the MongoDB server (database engine) as a <a href="http://www.linfo.org/daemon.html" target="_blank" rel="noopener noreferrer">daemon process<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> running in the Docker container. It will be accessible to MongoDB Compass (and any other client application) on <strong>port 27017</strong> - that is the default port for MongoDB.</p> <p>Now open the MongoDB Compass app and connect using this connection string <code>mongodb://localhost:27017</code>.</p> <p><img src="/W2022/assets/img/screenshot-compass-connect.0342dfa2.png" alt="screenshot of the new connection window"></p> <p>You should now see an active connection to the database engine that looks like this ...</p> <p><img src="/W2022/assets/img/screenshot-compass-connected.97104d30.png" alt="screenshot of the new connection window"></p> <p>This will let you visually inspect the database and interactively create, update, and delete documents in the database. We will use this to verify our work in later activities.</p> <p><img src="/W2022/assets/img/stormtroopers-why-are-we-here.f5f24a87.jpg" alt="so, why are we here?"></p> <h3 id="connect-to-mongodb-from-node-js"><a href="#connect-to-mongodb-from-node-js" class="header-anchor">#</a> Connect to MongoDB from Node.js</h3> <p>All that set-up was so that we can persist application state in a database.</p> <p>In your Node.js apps, you will need to open a connection to the MongoDB database so that you can store and retrieve your resource objects (JSON documents). MongoDB provides a <a href="https://www.npmjs.com/package/mongodb" target="_blank" rel="noopener noreferrer">official NPM package<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> which we can use to interact with the database. To install it in your project, simply run <code>npm install mongodb</code> in the terminal.</p> <p><strong>However</strong> ...</p> <p>For this course we will instead be using a popular data modelling library called <a href="https://mongoosejs.com" target="_blank" rel="noopener noreferrer">Mongoose<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <img alt="preview of the Mongoose website" src="/W2022/assets/img/screenshot-mongoose-website.7c3f3a07.png" class="screenshot"> <h3 id="mongoose-quick-start"><a href="#mongoose-quick-start" class="header-anchor">#</a> Mongoose Quick Start</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> mongoose
</code></pre></div><p>Create a new file in your project folder called <code>mongooseTest.js</code>. We will give the <code>mongoose.connect</code> method the same connection string for our local MongoDB server that we used with Compass and then append the name of the database we want to connect to at the end. Let's call the database <em>test</em>. The full connection string should now be <code>mongodb://localhost:27017/test</code>.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/test'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  useCreateIndex<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  useFindAndModify<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The mongoose.connect() method takes two arguments. The first is the connection string. The second is a <a href="https://mongoosejs.com/docs/connections.html#options" target="_blank" rel="noopener noreferrer">configuration options object<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Here we have used the <code>useNewUrlParser: true</code> option and the <code>useUnifiedTopology: true</code> option. These are required for connecting to MongoDB servers of version 4.0 or higher. Also, with this option, the <strong>port number MUST be included</strong> in the connection string.</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Even though we have not previously created this <code>/test</code> database, MongoDB will automatically create it the first time we try to interact with it.</p></div> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> String<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> kitty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Spot'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
kitty<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">savedKitty</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>savedKitty<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> says 'meow'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>The <code>mongoose.model</code> method is a <a href="https://en.wikipedia.org/wiki/Factory_method_pattern" target="_blank" rel="noopener noreferrer">class factory<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> that creates a resource class that represents a document collection and we can use it to interact with the database. In the example above we are giving it two properties: <code>'Cat'</code> is the name of the class of objects to store in a collection in the database, and <code>{name: String}</code> is the expected shape of each 'Cat' document - it will have a property called 'name' which will hold some string data.</p> <p><strong>An instance of a Model is a Mongoose Document.</strong><br>
Use the <code>new</code> keyword with the model class to create a new instance, or new database document from that class.</p> <div class="custom-block tip"><p class="custom-block-title">Naming conventions</p> <p>Models are named as a singular noun and start with a capital letter. Database tables or document collections are named as the plural of the model name and are all lower case.</p></div> <p>OK. Lets run it and then check the results in MongoDB Compass.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>node mongooseTest.js
</code></pre></div><p>Let's try adding another Cat instance to the collection. Change the name on line three and rerun it.</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> String<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> kitty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Patches'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
kitty<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">savedKitty</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>savedKitty<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> says 'meow'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Let's try adding an age to our next Cat.</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> String<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> kitty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Callie'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
kitty<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">savedKitty</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>savedKitty<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> says 'meow'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>This time, when we check it in Compass the age was not saved. Our Mongoose Model automatically discards any properties that are not predefined. This time change the model schema as well.</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> String<span class="token punctuation">,</span> age<span class="token operator">:</span> Number<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> kitty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Callie'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
kitty<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">savedKitty</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>savedKitty<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> says 'meow'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>We can also insert many objects into the database at once.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> String<span class="token punctuation">,</span> age<span class="token operator">:</span> Number<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> newCats <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Fluffy'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Pink Spots'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Tabatha'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
Cat<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span>newCats<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">docs</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>We have added many documents to our collection. How do we retrieve them? Add a new line to find all of the <code>cats</code> from the database.</p> <div class="language-js extra-class"><pre class="language-js"><code>Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span>listAll<span class="token operator">:</span> result<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>How about listing just the Cats with the name 'Spot'?</p> <div class="language-js extra-class"><pre class="language-js"><code>Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Spot'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span>spot<span class="token operator">:</span> result<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>That found all of the cats with the exact name 'Spot'. But, what if we wanted to check for names <em>like</em> Spot? We can use <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions" target="_blank" rel="noopener noreferrer">regular expressions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to match patterns. Replace the quotes with slashes. Now it will match 'Spot', 'Spots', 'Spotty', or 'Pink Spots'.</p> <div class="language-js extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br></div><pre class="language-js"><code>Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Spot</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span>regex<span class="token operator">:</span> result<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Regular expressions can be a very powerful tool. Checkout the <a href="#for-next-week">resources linked below</a> to learn more.</p> <p>Putting it all together, the final version of our <code>mongooseTest.js</code> should look like this.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span>

<span class="token comment">// Import the Mongoose library</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>

<span class="token comment">// Connect the mongoose instance to our MongoDB</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/test'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  useCreateIndex<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  useFindAndModify<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Define the document model for the 'cats' collection</span>
<span class="token keyword">const</span> Cat <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> String<span class="token punctuation">,</span> age<span class="token operator">:</span> Number<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Create a new Cat document and save it to the database</span>
<span class="token keyword">const</span> kitty <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Callie'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
kitty<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">savedKitty</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>savedKitty<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> says 'meow'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// Directly insert an array of Cat property objects</span>
<span class="token keyword">const</span> newCats <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Fluffy'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Pink Spots'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'Tabatha'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
Cat<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span>newCats<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">docs</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>docs<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// List all of the Cats in the collection</span>
Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span>listAll<span class="token operator">:</span> result<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// List only the Cats with 'Spot' in the name</span>
Cat<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Spot</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span>regex<span class="token operator">:</span> result<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>There is a lot more to learn about how to use Mongoose and we will continue next week. In particular we will look at how to integrate Mongoose with our <code>carsRouter.js</code> from last week. In preparation, please review the reading material below.</p> <h2 id="ex5-set-up-mongodb"><a href="#ex5-set-up-mongodb" class="header-anchor">#</a> EX5 Set-up MongoDB</h2> <p>Submit a screenshot of MongoDB Compass showing the connection to <strong>localhost:27017/test.cats</strong> and the listing of the documents in the collection after your test transactions.</p> <p><img src="/W2022/assets/img/screenshot-compass.737178b0.png" alt="example compass screenshot"></p> <h2 id="for-next-week"><a href="#for-next-week" class="header-anchor">#</a> For next week</h2> <p>Before next week's class, please read these additional online resources.</p> <ul><li><a href="https://mongoosejs.com/docs/models.html" target="_blank" rel="noopener noreferrer">Mongoose Docs: Models<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://mongoosejs.com/docs/documents.html" target="_blank" rel="noopener noreferrer">Mongoose Docs: Documents<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://mongoosejs.com/docs/queries.html" target="_blank" rel="noopener noreferrer">Mongoose Docs: Queries<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.lynda.com/JavaScript-tutorials/Regular-expressions/782146/5029404-4.html" target="_blank" rel="noopener noreferrer">Regular Expressions (regex)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>video</span></li> <li><a href="https://medium.com/factory-mind/regex-tutorial-a-simple-cheatsheet-by-examples-649dc1c3f285" target="_blank" rel="noopener noreferrer">Regex tutorial — A quick cheat sheet by examples<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.youtube.com/watch?v=zPeEU9dP83M" target="_blank" rel="noopener noreferrer">Intro to Regex<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>video</span></li> <li><a href="https://www.youtube.com/watch?v=kUMA1d1Sqto" target="_blank" rel="noopener noreferrer">RegEx in JS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>video</span></li></ul> <div class="custom-block warning"><p class="custom-block-title">Quiz</p> <p>There will be a short quiz next class. The questions could come from any of the material referenced above.</p></div> <div class="custom-block danger"><p class="custom-block-title">Family Day</p> <p>Our scheduled class for week 7 falls on Family Day, and the college is closed. I will post a pre-recorded lecture/demo explaining topics related to data security and using ES Modules with Express. You can watch that when it is convenient for you.</p> <p>I will also be holding a special open lab session on Tuesday, February 22, 2022 from 6:00 pm until 8:00 pm for anyone who would like assistance with the lab exercises.</p> <p>The week 7 quiz will be available to be completed any time before 11:59 pm on Tuesday, February 22, 2022</p></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/6/2022, 7:17:43 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/W2022/modules/week4/" class="prev">
        Week 4: Middleware functions
      </a></span> <span class="next"><a href="/W2022/modules/week6/">
        Week 6: Object Data Modelling
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/W2022/assets/js/app.cec51691.js" defer></script><script src="/W2022/assets/js/3.9c2ff4f7.js" defer></script><script src="/W2022/assets/js/9.665b29a5.js" defer></script><script src="/W2022/assets/js/11.f11acbbb.js" defer></script><script src="/W2022/assets/js/16.1ec56656.js" defer></script>
  </body>
</html>
