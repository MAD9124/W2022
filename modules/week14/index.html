<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Week 14: Production Deployment | MAD9124</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Full Stack: API Development">
    
    <link rel="preload" href="/W2022/assets/css/0.styles.7a32498c.css" as="style"><link rel="preload" href="/W2022/assets/js/app.cec51691.js" as="script"><link rel="preload" href="/W2022/assets/js/3.9c2ff4f7.js" as="script"><link rel="preload" href="/W2022/assets/js/2.b4d63df3.js" as="script"><link rel="preload" href="/W2022/assets/js/11.f11acbbb.js" as="script"><link rel="prefetch" href="/W2022/assets/js/10.31dfe672.js"><link rel="prefetch" href="/W2022/assets/js/12.96649c49.js"><link rel="prefetch" href="/W2022/assets/js/13.535bc82d.js"><link rel="prefetch" href="/W2022/assets/js/14.028cb9d2.js"><link rel="prefetch" href="/W2022/assets/js/15.ced8bd8c.js"><link rel="prefetch" href="/W2022/assets/js/16.1ec56656.js"><link rel="prefetch" href="/W2022/assets/js/17.a48a571a.js"><link rel="prefetch" href="/W2022/assets/js/18.1528acad.js"><link rel="prefetch" href="/W2022/assets/js/19.61d8cc80.js"><link rel="prefetch" href="/W2022/assets/js/20.4071399f.js"><link rel="prefetch" href="/W2022/assets/js/21.e5b3b049.js"><link rel="prefetch" href="/W2022/assets/js/22.8b4aae43.js"><link rel="prefetch" href="/W2022/assets/js/23.61c52980.js"><link rel="prefetch" href="/W2022/assets/js/24.55bc8f66.js"><link rel="prefetch" href="/W2022/assets/js/25.4ac50e54.js"><link rel="prefetch" href="/W2022/assets/js/26.9ce0e977.js"><link rel="prefetch" href="/W2022/assets/js/27.3a9bd92a.js"><link rel="prefetch" href="/W2022/assets/js/28.06fd6a07.js"><link rel="prefetch" href="/W2022/assets/js/29.1bb95a0c.js"><link rel="prefetch" href="/W2022/assets/js/30.dae4692c.js"><link rel="prefetch" href="/W2022/assets/js/31.8fbfd6d3.js"><link rel="prefetch" href="/W2022/assets/js/32.68c3574f.js"><link rel="prefetch" href="/W2022/assets/js/33.617cdd3b.js"><link rel="prefetch" href="/W2022/assets/js/34.e9d21a2b.js"><link rel="prefetch" href="/W2022/assets/js/35.6e9bfe39.js"><link rel="prefetch" href="/W2022/assets/js/36.d4810b3d.js"><link rel="prefetch" href="/W2022/assets/js/37.8f7eb267.js"><link rel="prefetch" href="/W2022/assets/js/38.23784716.js"><link rel="prefetch" href="/W2022/assets/js/39.2e9e7983.js"><link rel="prefetch" href="/W2022/assets/js/4.a3d079e3.js"><link rel="prefetch" href="/W2022/assets/js/40.7f13d575.js"><link rel="prefetch" href="/W2022/assets/js/5.3200619b.js"><link rel="prefetch" href="/W2022/assets/js/6.4a9ec533.js"><link rel="prefetch" href="/W2022/assets/js/7.f496cd23.js"><link rel="prefetch" href="/W2022/assets/js/8.0225588a.js"><link rel="prefetch" href="/W2022/assets/js/9.665b29a5.js">
    <link rel="stylesheet" href="/W2022/assets/css/0.styles.7a32498c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/W2022/" class="home-link router-link-active"><!----> <span class="site-name">MAD9124</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/W2022/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/W2022/modules/" class="nav-link router-link-active">
  Modules
</a></div><div class="nav-item"><a href="/W2022/deliverables/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/W2022/resources/" class="nav-link">
  Resources
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/W2022/overview/" class="nav-link">
  Overview
</a></div><div class="nav-item"><a href="/W2022/modules/" class="nav-link router-link-active">
  Modules
</a></div><div class="nav-item"><a href="/W2022/deliverables/" class="nav-link">
  Deliverables
</a></div><div class="nav-item"><a href="/W2022/resources/" class="nav-link">
  Resources
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Introduction</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Deliverables</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Content Modules</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/W2022/modules/" aria-current="page" class="sidebar-link">Table of contents</a></li><li><a href="/W2022/modules/week1/" class="sidebar-link">Week 1: Introduction &amp; Review</a></li><li><a href="/W2022/modules/week2/" class="sidebar-link">Week 2: Node Modules &amp; Express</a></li><li><a href="/W2022/modules/week3/" class="sidebar-link">Week 3: RESTful APIs</a></li><li><a href="/W2022/modules/week4/" class="sidebar-link">Week 4: Middleware functions</a></li><li><a href="/W2022/modules/week5/" class="sidebar-link">Week 5: Data persistence</a></li><li><a href="/W2022/modules/week6/" class="sidebar-link">Week 6: Object Data Modelling</a></li><li><a href="/W2022/modules/week7/" class="sidebar-link">Week 7: Data security</a></li><li><a href="/W2022/modules/break-week/" class="sidebar-link">Break Week</a></li><li><a href="/W2022/modules/week9/" class="sidebar-link">Week 9: Access Control with JWT</a></li><li><a href="/W2022/modules/week10/" class="sidebar-link">Week 10: JWT Review</a></li><li><a href="/W2022/modules/week11/" class="sidebar-link">Week 11: Consistent Error Handling</a></li><li><a href="/W2022/modules/week12/" class="sidebar-link">Week 12: Production Preparation</a></li><li><a href="/W2022/modules/week13/" class="sidebar-link">Week 13: Testing</a></li><li><a href="/W2022/modules/week14/" aria-current="page" class="active sidebar-link">Week 14: Production Deployment</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#architecture" class="sidebar-link">Architecture</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#setup-hosted-mongodb" class="sidebar-link">Setup Hosted MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#create-a-mongodb-cloud-account" class="sidebar-link">Create a MongoDB cloud account</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#create-database-cluster" class="sidebar-link">Create Database Cluster</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#connect-mongoose-to-the-atlas-cluster" class="sidebar-link">Connect Mongoose to the Atlas Cluster</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#update-the-connectdatabase-js-module" class="sidebar-link">Update the connectDatabase.js Module</a></li></ul></li><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#health-check-route" class="sidebar-link">Health Check Route</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#publish-a-docker-image" class="sidebar-link">Publish a Docker Image</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#create-a-dockerfile" class="sidebar-link">Create a Dockerfile</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#split-server-js-and-app-js" class="sidebar-link">Split server.js and app.js</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#build-a-local-docker-image" class="sidebar-link">Build a local Docker image</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#tag-the-image" class="sidebar-link">Tag the image</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#push-the-image-to-docker-hub" class="sidebar-link">Push the image to Docker Hub</a></li></ul></li><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#deploying-to-aws" class="sidebar-link">Deploying to AWS</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#aws-classroom-account" class="sidebar-link">AWS Classroom Account</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#configure-the-elastic-container-service" class="sidebar-link">Configure the Elastic Container Service</a></li><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#congratulations" class="sidebar-link">Congratulations!</a></li></ul></li><li class="sidebar-sub-header"><a href="/W2022/modules/week14/#for-additional-resources" class="sidebar-link">For additional resources</a></li></ul></li><li><a href="/W2022/modules/week15/" class="sidebar-link">Week 15: Final Lab</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1><span class="week">Week 14</span><br> <span class="title">Production Deployment</span></h1> <div class="custom-block warning"><p class="custom-block-title">Assignment Reminder</p> <p><a href="/W2022/deliverables/final.html">Final project - GIFTR</a> is due by <strong>6:00 pm April 20, 2022</strong>.<br>
This is the final deadline. There will be no extensions.</p> <p>Counts for 30% of your MAD9124 final grade.</p></div> <h2 id="architecture"><a href="#architecture" class="header-anchor">#</a> Architecture</h2> <p>Of all cloud infrastructure service providers, Amazon Web Services (AWS) is far and away the market leader. We will take advantage of their generous education credits to learn how to deploy the final project using a typical architectural pattern.</p> <p>Your main web service API application will be bundled into a Docker container which can be auto-scaled in response to service demand. This service container cluster will be accessed via an Application Load Balancer, which can also manage the secure HTTPS connection with the client application. The Node Express containers will talk to a MongoDB service running in another high-availability cluster.</p> <p>Additionally, your client application from MAD9022 could be served from a global content delivery network – but we will not tackle that for this project.</p> <p>The key service components that you typically need include:</p> <p><strong>Backend Web Service</strong></p> <ul><li>Docker Hub (image repository)</li> <li>Amazon Virtual Private Cloud (VPC)</li> <li><strike>AWS Certificate Manager</strike></li> <li>Amazon Elastic Application Load Balancer (ELB)</li> <li>Amazon Elastic Container Service (ECS) with Fargate</li> <li>MongoDB Atlas – deployed to a managed Amazon Elastic Cloud Compute (EC2) Cluster</li></ul> <p><strong>Frontend Client APP</strong></p> <ul><li><strike>Amazon Simple Storage Service (S3)</strike></li> <li><strike>Amazon CloudFront (CDN)</strike></li> <li>GitHub PWA Private Repo</li></ul> <h2 id="setup-hosted-mongodb"><a href="#setup-hosted-mongodb" class="header-anchor">#</a> Setup Hosted MongoDB</h2> <p>We will use the free tier of the <a href="https://www.mongodb.com/cloud/atlas" target="_blank" rel="noopener noreferrer">MongoDB Atlas<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> service to deploy a managed MongoDB service cluster to the same AWS region as our production Express server containers.</p> <h3 id="create-a-mongodb-cloud-account"><a href="#create-a-mongodb-cloud-account" class="header-anchor">#</a> Create a MongoDB cloud account</h3> <p>From the <a href="https://www.mongodb.com/" target="_blank" rel="noopener noreferrer">MongoDB home page<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, click the green <code>Start Free</code> button.
<img src="/W2022/assets/img/mongo-homepage.ab3e76a9.png" alt="MongoDB home page"></p> <p>Fill in the form to create your free account. <strong>Please use your Algonquin College email address</strong>.
<img src="/W2022/assets/img/mongo-atlas-create-account.30dfcda3.png" alt="Atlas sign-up form"></p> <p>You should shortly receive a confirmation email from MongoDB Atlas. Click the <code>Sign In</code> button in that email.
<img src="/W2022/assets/img/mongo-atlas-confirmation-email.75dd2831.png" alt="Confirmation email"></p> <p>That will take you to the <a href="https://account.mongodb.com/account/login" target="_blank" rel="noopener noreferrer">MongoDB Atlas login page<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.
<img src="/W2022/assets/img/mongo-atlas-login.e8772dae.png" alt="MongoDB Atlas Login"></p> <h3 id="create-database-cluster"><a href="#create-database-cluster" class="header-anchor">#</a> Create Database Cluster</h3> <p>Follow the prompts to create your first Project and Cluster.</p> <p><img src="/W2022/assets/img/mongo-create-cluster.70967fa3.png" alt="create cluster"></p> <p>Choose the <strong>Shared Clusters</strong> option on the left – the free one.
<img src="/W2022/assets/img/mongo-shared-clusters.7eddf090.png" alt="shared clusters"></p> <h4 id="configure-cluster"><a href="#configure-cluster" class="header-anchor">#</a> Configure Cluster</h4> <p>Choose <strong>AWS</strong> as the cloud provider. <strong>DO NOT</strong> choose 'Multi-Region ...'</p> <p>Choose the <strong>N. Virginia</strong> AWS Region.
<img src="/W2022/assets/img/mongo-cluster-provider.7c414a5b.png" alt="cluster configuration - AWS region"></p> <p>Under the heading <strong>Cluster Tier</strong>, choose <code>M0 Sandbox</code> – this is the free one.
<img src="/W2022/assets/img/mongo-cluster-size.6d814b8e.png" alt="cluster configuration - size"></p> <p>Do not select any <strong>Additional Settings</strong>. They are not available in the free tier.</p> <p>Set the <strong>Cluster Name</strong> to <code>GIFTR</code>.
<img src="/W2022/assets/img/mongo-cluster-name.ead36e99.png" alt="cluster configuration - name"></p> <p>Verify your settings and click the green <code>Create Cluster</code> button.</p> <p>You should now see the <strong>Clusters Dashboard</strong> while your new cluster is being provisioned. There should be a blue <code>sandbox</code> label on your cluster – this confirms that you correctly selected the free tier.
<img src="/W2022/assets/img/mongo-cluster-dashboard.48fa593c.png" alt="cluster configuration - name"></p> <h4 id="set-up-connection-security"><a href="#set-up-connection-security" class="header-anchor">#</a> Set-up Connection Security</h4> <p>There are still a few more steps. Click the <code>connect</code> button under your cluster name to bring up an information modal.</p> <p>You will be accessing this cluster from multiple locations – home, school, and your AWS containers. You could (and in a real app SHOULD) designate an allowed list of only the IP addresses that <em>need</em> to connect to the database. But, for simplicity with this project simply allow all.
<img src="/W2022/assets/img/mongo-whitelist-ips.4e635c11.png" alt="cluster configuration - IP addresses"></p> <p>Click the <code>Add a Different IP Address</code> button, and then enter <code>0.0.0.0/0</code> for the IP address (<a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing" target="_blank" rel="noopener noreferrer">CDIR notation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>) and click <code>Add IP Address</code>.</p> <p>Next you will be asked to create an new administrative user for your database cluster. I called mine <code>madadmin</code> and selected the <code>autogenerate password</code> option for a reasonably secure random password.</p> <p><img src="/W2022/assets/img/mongo-create-user.08dd85da.png" alt="create database user"></p> <div class="custom-block danger"><p class="custom-block-title">Copy the password</p> <p>Don't forget to click the <code>show</code> button next to the password, and then copy it to your config JSON file. <strong>You will never see this password again.</strong></p></div> <p>You will need to get the connection string details for this new database cluster. Click the <code>Choose connection method</code> button at the bottom of the modal.
<img src="/W2022/assets/img/mongo-choose-connection-method.d6cf4669.png" alt="create database user"></p> <p>You want the middle option <strong>Connect your application</strong>.
<img src="/W2022/assets/img/mongo-connect-options.ac4d4be9.png" alt="cluster connection options"></p> <p>Copy the <strong>hostname</strong> portion of the connection string. It will go in your config JSON file later.
<img src="/W2022/assets/img/mongo-connect-string.a0fac0d2.png" alt="cluster connection string"></p> <p>Copy the <strong>authentication database name</strong> portion of the connection string. You will need that in your config JSON file too.
<img src="/W2022/assets/img/mongo-connect-string2.93e1fbd7.png" alt="cluster connection string"></p> <h3 id="connect-mongoose-to-the-atlas-cluster"><a href="#connect-mongoose-to-the-atlas-cluster" class="header-anchor">#</a> Connect Mongoose to the Atlas Cluster</h3> <p>Up until now, the connection string in your Express application code to tell Mongoose how to open a connection to the database took this format:</p> <div class="language- extra-class"><pre class="language-text"><code>mongodb://hostname:port/database-name
</code></pre></div><p>e.g.</p> <div class="language- extra-class"><pre class="language-text"><code>mongodb://localhost:27017/mad9124
</code></pre></div><h4 id="hosted-atlas-cluster"><a href="#hosted-atlas-cluster" class="header-anchor">#</a> Hosted Atlas Cluster</h4> <p>The full connection string for MongoDB databases hosted on an Atlas cluster look a little different. Here is what mine looks like:</p> <div class="language- extra-class"><pre class="language-text"><code>mongodb+srv://&lt;username&gt;:&lt;password&gt;@giftr-1p8fa.mongodb.net/test?retryWrites=true&amp;w=majority
</code></pre></div><p><em>(Don't use this one. Go get your own.)</em></p> <h5 id="from-the-above-example"><a href="#from-the-above-example" class="header-anchor">#</a> From the above example</h5> <p>The scheme changes to <code>mongodb+srv://</code></p> <p>Database user credentials are inserted: <code>&lt;username&gt;:&lt;password&gt;@</code></p> <p>The hostname becomes <code>_something_.mongodb.net</code><br>
(where <em>something</em> is your unique cluster name)</p> <p>The default database <code>/test</code> is used to authenticate the db user.</p> <p>There are some other options set at the end: <code>?retryWrites=true&amp;w=majority</code></p> <h3 id="update-the-connectdatabase-js-module"><a href="#update-the-connectdatabase-js-module" class="header-anchor">#</a> Update the <code>connectDatabase.js</code> Module</h3> <p>It is a very common practice to set up a final integration testing or staging environment that very closely mirrors the production environment. That is what we are going to do for the final project. This will simplify some of the deployment details.</p> <p>Remember the configuration variables are retrieved using the <code>config.get()</code> method. We will set the <code>NODE_ENV</code> environment variable to<code>stage</code>, so you will need to create a new <code>/config/stage.json</code> file with your connection credentials. e.g.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;db&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;scheme&quot;</span><span class="token operator">:</span> <span class="token string">&quot;mongodb+srv&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;madadmin&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;yourGuessIsAsGoodAsMine&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;giftr-1p8fa.mongodb.net&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;authSource&quot;</span><span class="token operator">:</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;w21-final-giftr&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>In a final production deployment, you would not store the database username and password in this config file. They should be injected into the runtime container using environment variables.</p> <p>But, this will let me better help you with troubleshooting and help me with grading your assignment.</p></div> <p>Then refactor the <code>/startup/connectDatabase.js</code> module, to conditionally construct the connection string based on the target scheme: <code>mongodb</code> v.s. <code>mongodb+srv</code>.</p> <p>The updated file should look something like this ...</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> config <span class="token keyword">from</span> <span class="token string">'config'</span>
<span class="token keyword">import</span> mongoose <span class="token keyword">from</span> <span class="token string">'mongoose'</span>
<span class="token keyword">import</span> logger <span class="token keyword">from</span> <span class="token string">'./logger.js'</span>

<span class="token keyword">const</span> log <span class="token operator">=</span> logger<span class="token punctuation">.</span><span class="token function">child</span><span class="token punctuation">(</span><span class="token punctuation">{</span>module<span class="token operator">:</span> <span class="token string">'connectDB'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">connectDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>scheme<span class="token punctuation">,</span> host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> name<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> authSource<span class="token punctuation">}</span> <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
    <span class="token string">'db'</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">const</span> credentials <span class="token operator">=</span> username <span class="token operator">&amp;&amp;</span> password <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>username<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>password<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">@</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span>

  <span class="token keyword">let</span> connectionString <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>scheme<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>credentials<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>host<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>scheme <span class="token operator">===</span> <span class="token string">'mongodb'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    connectionString <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?authSource=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>authSource<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    connectionString <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>authSource<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?retryWrites=true&amp;w=majority</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      useCreateIndex<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      useFindAndModify<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      dbName<span class="token operator">:</span> name
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Connected to MongoDB @ </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error connecting to MongoDB ...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>OK. LET'S TEST IT!</strong></p> <p>Update the <code>scripts</code> key of the <code>package.json</code> file to add a <code>stage</code> script. It will be the same as the <code>dev</code> script except the environment variable should be set as <code>NODE_ENV=stage</code>.</p> <div class="language-json extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;API_JWTKEY=supersecretkey nodemon server.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;stage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NODE_ENV=stage API_JWTKEY=supersecretkey nodemon server.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node server.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>Start the server using this new script – <code>npm run stage</code> – in the terminal and use Postman to make sure that everything is working.</p> <p>You can still visually check the contents of the database with MongoDB Compass. Use the full connection string from the Atlas dashboard (third option) to create a new connection in MongoDB Compass.</p> <p><img src="/W2022/assets/img/mongo-connect-options.ac4d4be9.png" alt="cluster connection options"></p> <p>Don't forget to replace <code>&lt;password&gt;</code> with your real password. e.g.</p> <div class="language- extra-class"><pre class="language-text"><code>mongodb+srv://madadmin:yourGuessIsAsGoodAsMine@giftr-1p8fa.mongodb.net/test
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Take a short break</p> <p>If you have everything working, take a short break before tackling the next steps.</p></div> <h2 id="health-check-route"><a href="#health-check-route" class="header-anchor">#</a> Health Check Route</h2> <p>Most production deployments will have some kind of automated periodic monitoring to see if your deployed service is still up and running. We facilitate this by creating a simple HTTP route handler in the main <code>app.js</code> module. It could be anything that you choose. The AWS Application Load Balancer will default to the root path for your web service, so let's just use that for now.</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token operator">:</span> <span class="token punctuation">{</span>healthStatus<span class="token operator">:</span> <span class="token string">'UP'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Amazon's Elastic Container Service (ECS) will regularly poll this route looking for a <code>200</code> response code. You will be able to see the health status in the AWS CloudWatch console.</p> <h2 id="publish-a-docker-image"><a href="#publish-a-docker-image" class="header-anchor">#</a> Publish a Docker Image</h2> <p>In most development teams these days, everyone needs to know a little about <a href="https://en.wikipedia.org/wiki/DevOps" target="_blank" rel="noopener noreferrer">DevOps<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. You could do a whole course on Docker, containers, and Kubernetes, but for now we are going to simulate a scenario that you are very like to encounter. As a junior developer, a more senior developer on the team has already designed the correct procedure to bundle and deploy your application, and they will give you some key files and instructions.</p> <p>Starting in module 5, you have been using Docker as an easy way to run MongoDB in your local development environment. You used a pre-made Docker Image definition (mongo:bionic) that was pulled from the public Docker Hub repository.</p> <p>You can create and publish your own Docker Image to bundle your Express web service application. This image can then be use to deploy one or more copies of your application on a cloud hosting service like AWS, Azure, or Google Cloud.</p> <div class="custom-block tip"><p class="custom-block-title">If you haven't already ...</p> <p>Create a free <a href="https://hub.docker.com" target="_blank" rel="noopener noreferrer">Docker Hub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> account.<br>
Download <strong>Docker Desktop</strong> and run the installer.</p></div> <h3 id="create-a-dockerfile"><a href="#create-a-dockerfile" class="header-anchor">#</a> Create a Dockerfile</h3> <p>The <code>Dockerfile</code> is the recipe for creating a Docker Image. It should be placed in the top level of your project folders. Note the capitalization and there is no extension - just <code>Dockerfile</code>.</p> <p>This will use the <a href="https://hub.docker.com/_/node" target="_blank" rel="noopener noreferrer">official node version 14 image<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> from Docker Hub as the starting point. It then creates the directory structure that your project requires and copies your code from your development project folder into the container image.</p> <div class="custom-block warning"><p class="custom-block-title">Check the names of your folders</p> <p>Make sure that your project folder structure matches the Dockerfile.</p></div> <div class="language-docker extra-class"><pre class="language-docker"><code><span class="token keyword">FROM</span> node<span class="token punctuation">:</span>14<span class="token punctuation">-</span>slim

<span class="token keyword">ENV</span> API_PORT=<span class="token string">&quot;80&quot;</span>
<span class="token keyword">ENV</span> DEBUG=<span class="token string">&quot;api:*&quot;</span>

<span class="token keyword">RUN</span> mkdir <span class="token punctuation">-</span>p /app /app/config /app/exceptions /app/logs /app/middleware /app/models /app/public /app/routes /app/startup

<span class="token keyword">COPY</span> config/ /app/config/
<span class="token keyword">COPY</span> exceptions/ /app/exceptions/
<span class="token keyword">COPY</span> middleware/ /app/middleware/
<span class="token keyword">COPY</span> models/ /app/models/
<span class="token keyword">COPY</span> public/ /app/public/
<span class="token keyword">COPY</span> routes/ /app/routes/
<span class="token keyword">COPY</span> startup/ /app/startup/
<span class="token keyword">COPY</span> server.js app.js package.json /app/

<span class="token keyword">WORKDIR</span> /app
<span class="token keyword">RUN</span> npm install <span class="token punctuation">-</span><span class="token punctuation">-</span>unsafe<span class="token punctuation">-</span>perm

<span class="token keyword">EXPOSE</span> 80
<span class="token keyword">CMD</span> node server.js
</code></pre></div><h3 id="split-server-js-and-app-js"><a href="#split-server-js-and-app-js" class="header-anchor">#</a> Split server.js and app.js</h3> <p>That final line in the Dockerfile, <code>CMD node server.js</code>. That is the command that will be invoked when the deployed container is started. If you have all of your Express application defined in <code>app.js</code>, then you could change the last line of the Dockerfile to be <code>CMD node app.js</code>.</p> <p>Or, as we did in an earlier module, you might want to create both a <code>server.js</code> file and an <code>app.js</code> file. This is a quite common practice as it separates the code for defining the Express routing application in the <code>app.js</code> file from the <code>server.js</code> module which only holds the instructions spinning up the Node.js HTTP server, and passing in the <code>app.js</code> module as a configuration object to the server.</p> <p>Here is an example <code>server.js</code> file serving only HTTP.<br> <strong>This is what you should use for your final project.</strong></p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">import</span> http <span class="token keyword">from</span> <span class="token string">'http'</span>
<span class="token keyword">import</span> logger <span class="token keyword">from</span> <span class="token string">'./startup/logger.js'</span>
<span class="token keyword">import</span> app <span class="token keyword">from</span> <span class="token string">'./app.js'</span>

<span class="token comment">/**
 * Create HTTP server.
 * HTTP server listen on provided port, on all network interfaces.
 */</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">API_PORT</span> <span class="token operator">||</span> <span class="token number">3030</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> onError<span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'listening'</span><span class="token punctuation">,</span> onListening<span class="token punctuation">)</span>

<span class="token comment">/**
 * Common listener callback functions
 */</span>
<span class="token keyword">function</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token string">'error'</span><span class="token punctuation">,</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Express failed to listen on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    err<span class="token punctuation">.</span>stack
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">onListening</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Express is listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If you are going to be running your Node.js server with HTTPS, you <strong>must</strong> set it up this way.</p></div> <p>Here is how it would look if we set it up to use HTTPS with a &quot;let's encrypt&quot; certificate.<br> <strong>This is for your future reference only. DO NOT use this for your final project.</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span>

<span class="token keyword">import</span> http <span class="token keyword">from</span> <span class="token string">'http'</span>
<span class="token keyword">import</span> https <span class="token keyword">from</span> <span class="token string">'https'</span>
<span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span>
<span class="token keyword">import</span> logger <span class="token keyword">from</span> <span class="token string">'./startup/logger.js'</span>
<span class="token keyword">import</span> app <span class="token keyword">from</span> <span class="token string">'./app.js'</span>

<span class="token comment">/**
 * Create HTTP server.
 * HTTP server listen on provided port, on all network interfaces.
 */</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">API_PORT</span> <span class="token operator">||</span> <span class="token number">3030</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> onError<span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'listening'</span><span class="token punctuation">,</span> onListening<span class="token punctuation">)</span>

<span class="token comment">/**
 * Create HTTPS server.
 * HTTPS server listen on standard port, on all network interfaces.
 */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
    key<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'/etc/letsencrypt/live/mad9124.rocks/privkey.pem'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    cert<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'/etc/letsencrypt/live/mad9124.rocks/fullchain.pem'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    ca<span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'/etc/letsencrypt/live/mad9124.rocks/chain.pem'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> serverSSL <span class="token operator">=</span> https<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> app<span class="token punctuation">)</span>
  <span class="token keyword">const</span> TLSPort <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">APP_TLSPORT</span> <span class="token operator">||</span> <span class="token number">443</span>
  serverSSL<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>TLSPort<span class="token punctuation">)</span>
  serverSSL<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> onError<span class="token punctuation">)</span>
  serverSSL<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'listening'</span><span class="token punctuation">,</span> onListening<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Common listener callback functions
 */</span>
<span class="token keyword">function</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token string">'error'</span><span class="token punctuation">,</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Express failed to listen on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    err<span class="token punctuation">.</span>stack
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">onListening</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Express is listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="simplified-app-js"><a href="#simplified-app-js" class="header-anchor">#</a> Simplified app.js</h4> <p>Now that the <code>app.js</code> module doesn't need any code for creating the HTTP server, it can be simplified to something like this ...</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> express <span class="token keyword">from</span> <span class="token string">'express'</span>
<span class="token keyword">import</span> connectDB <span class="token keyword">from</span> <span class="token string">'./startup/connectDatabase'</span>
<span class="token function">connectDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Apply global middleware with app.use()</span>

<span class="token comment">// Add the health check route</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token operator">:</span> <span class="token punctuation">{</span>healthStatus<span class="token operator">:</span> <span class="token string">'UP'</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// Link the auth and api route handler modules</span>

<span class="token comment">// Apply the global error handler middleware</span>

<span class="token comment">// Export the `app` object</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> app
</code></pre></div><h3 id="build-a-local-docker-image"><a href="#build-a-local-docker-image" class="header-anchor">#</a> Build a local Docker image</h3> <p>We have created the Dockerfile and refactored our code. It is time to build the container image with the <a href="https://docs.docker.com/engine/reference/commandline/build/" target="_blank" rel="noopener noreferrer">docker build<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> command. Use the <code>--tag=</code> command option to set the name of the local Docker Image file that will be created. The <code>:latest</code> suffix is the version label.</p> <div class="language- extra-class"><pre class="language-text"><code>docker build --tag=giftr-api-w21:latest .
</code></pre></div><p>This will create an Ubuntu Linux container with Node v14 pre configured and then copy in your project files as defined in the <code>Dockerfile</code>. Then it will run <code>npm install</code> in your container image's project root folder (<code>/app</code>) to ensure that all required dependencies are correctly installed.</p> <p>When this process is complete you will have a new Docker Image that you can use to create an isolated runtime copy of your Express web service application. You can run it with Docker locally to test it.</p> <p>Here is an updated <code>docker-compose.yml</code> file that will use the image you just created to spin up a new container on your local machine for testing.</p> <p><strong>First, make sure that you stop any other Express server that you might have running.</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">express</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> giftr<span class="token punctuation">-</span>api<span class="token punctuation">-</span>w21
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> giftr<span class="token punctuation">-</span>api<span class="token punctuation">-</span>w21
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">API_JWTKEY</span><span class="token punctuation">:</span> keur0uhwg802fkzh6e72lw0m69g3xv
      <span class="token key atrule">API_PORT</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">NODE_ENV</span><span class="token punctuation">:</span> <span class="token string">'stage'</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 3030<span class="token punctuation">:</span><span class="token number">80</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> node server.js
</code></pre></div><p>Now run <code>docker-compose up -d express</code>. If everything is configured correctly, your new API server container will spin up and try to authenticate with the MongoDB Atlas server that you set up earlier.</p> <p>Try sending some test requests from Postman to <code>localhost:3030</code>. Then check the MongoDB Atlas database with MongoDB Compass to visually verify the requests went to the correct database.</p> <p>If everything looks good you can publish the Docker Image to Docker Hub.</p> <h3 id="tag-the-image"><a href="#tag-the-image" class="header-anchor">#</a> Tag the image</h3> <p>Before you can push the image up to Docker Hub, you need to <code>tag</code> the local image with your Docker Hub username prefix. Replace <code>&lt;username&gt;</code> with your Docker Hub username.</p> <div class="language- extra-class"><pre class="language-text"><code>docker tag giftr-api-w21 &lt;username&gt;/giftr-api-w21
</code></pre></div><h3 id="push-the-image-to-docker-hub"><a href="#push-the-image-to-docker-hub" class="header-anchor">#</a> Push the image to Docker Hub</h3> <p>Make sure that you are logged into Docker Hub. This command will prompt you for your Docker Hub username and password.</p> <div class="language- extra-class"><pre class="language-text"><code>docker login docker.io
</code></pre></div><p>Now you can push it. Replace <code>&lt;username&gt;</code> with your Docker Hub username.</p> <div class="language- extra-class"><pre class="language-text"><code>docker push &lt;username&gt;/giftr-api-w21
</code></pre></div><p><strong>Congratulations!</strong></p> <p>You have successfully published your first Docker Image.</p> <div class="custom-block tip"><p class="custom-block-title">Take a short break</p> <p>If you have everything working, take a short break before tackling the next steps.</p></div> <h2 id="deploying-to-aws"><a href="#deploying-to-aws" class="header-anchor">#</a> Deploying to AWS</h2> <p>Now it is time to set up the hosting environment on AWS for your Docker container to run.</p> <h3 id="aws-classroom-account"><a href="#aws-classroom-account" class="header-anchor">#</a> AWS Classroom Account</h3> <p>By now you should have received an email invitation to join our AWS Classroom and sign-up for a free AWS Educate - Student Account. There are <a href="https://aws.amazon.com/education/awseducate/students/" target="_blank" rel="noopener noreferrer">many benefits<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> attached to the free student account which you can use to continue your learning over the summer.</p> <p>Once you have accepted the invitation and logged into the AWS Educate portal, find the link to &quot;My Classrooms&quot;. You should see one listed for &quot;<strong>Mobile API Development - W21</strong>&quot;. Click the blue &quot;Go to classroom&quot; button on the right.
<img src="/W2022/assets/img/aws-classroom.b70bbfb5.png" alt="AWS classrooms list"></p> <p>You will now be prompted to agree to the <em>terms and conditions</em> for using the service.
<img src="/W2022/assets/img/aws-classroom-setup12.b0856cfe.png" alt="Vocareum dashboard"></p> <p>Your browser should be redirected to the <strong>Vocareum Dashboard</strong>. Click on the card for Mobile API Development. This will open a summary page for your AWS Educate Classroom Account. It has some helpful FAQs and you can see your remaining credit balance for AWS services. You have been given a $50 for this classroom, which is more than enough to cover what we will do, and give you some credits to play with over the summer.
<img src="/W2022/assets/img/aws-classroom-setup15.5f332920.png" alt="AWS account summary"></p> <p>Click on the <strong>AWS Console</strong> button and you will be automatically logged into the AWS Console with your AWS Educate Classroom account.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>This may trigger the &quot;pop-up blocker&quot; in your browser. You will need to grant permission for this site. Look for the warning notice in the URL bar.</p></div> <p>Now you know how to get logged in. We can start doing real work!
<img src="/W2022/assets/img/aws-classroom-setup16.df90114d.png" alt="AWS console"></p> <h3 id="configure-the-elastic-container-service"><a href="#configure-the-elastic-container-service" class="header-anchor">#</a> Configure the Elastic Container Service</h3> <h4 id="_1-go-to-the-ecs-console"><a href="#_1-go-to-the-ecs-console" class="header-anchor">#</a> 1. Go to the ECS console</h4> <p>Type <code>ECS</code> into the <strong>Find Services</strong> search box on the AWS Console and then select the <strong>Elastic Container Service</strong> <img src="/W2022/assets/img/aws-search-ecs.20ef23ea.png" alt="AWS console - search"></p> <h4 id="_2-ecs-get-started"><a href="#_2-ecs-get-started" class="header-anchor">#</a> 2. ECS - Get Started</h4> <p>On the next screen you should see an orange <strong>Get Started</strong> button. Click that to begin the configuration process.<br> <img src="/W2022/assets/img/aws-ecs-get-started.feb83cd5.png" alt="ECS console - get started"></p> <h4 id="_3-define-aws-ecs-container-task-service"><a href="#_3-define-aws-ecs-container-task-service" class="header-anchor">#</a> 3. Define AWS ECS Container/Task/Service</h4> <p>Now define the runtime parameters for your container service. There are several related parts and they fit together like Russian nesting dolls.</p> <ul><li>A container definition links to the Docker image that you pushed to DockerHub.</li> <li>A task sets the resources (vCPU, RAM) for a container definition.</li> <li>A service may include one or more related tasks, and defines scaling rules.</li> <li>A cluster hosts one or more services and defines the general network settings.</li></ul> <p><img src="/W2022/assets/img/aws-ecs-hierarchy.91fe84ad.png" alt="ECS hierarchy diagram"></p> <h5 id="cluster-definition"><a href="#cluster-definition" class="header-anchor">#</a> Cluster Definition</h5> <p>Click the orange <strong>Create Cluster</strong> button.</p> <p><img src="/W2022/assets/img/aws-ecs-step-1.aea3d618.png" alt="ECS configuration step 1"></p> <p>Choose <strong>Networking only</strong> and then click the blue <strong>Next step</strong> button at the bottom of the page.</p> <p><img src="/W2022/assets/img/aws-ecs-step-2.a6479fa1.png" alt="ECS configuration step 2"></p> <p>Set the cluster name to <code>mad9124</code>, and click the blue <strong>Create</strong> button at the bottom of the page.</p> <p><img src="/W2022/assets/img/aws-ecs-step-3.01b915d9.png" alt="ECS configuration step 3"></p> <p>You should see a confirmation page.</p> <p><img src="/W2022/assets/img/aws-ecs-step-4.b66a7e77.png" alt="ECS configuration step 4"></p> <h5 id="task-definition"><a href="#task-definition" class="header-anchor">#</a> Task Definition</h5> <p>Expand the left-hand menu and click on <strong>Task Definitions</strong>. Then click the blue <strong>Create new Task Definition</strong> button.</p> <p><img src="/W2022/assets/img/aws-ecs-step-5.3ce3c149.png" alt="ECS configuration step 5"></p> <p>Choose <strong>Fargate</strong> and click the blue <strong>next</strong> button at the bottom of the page.</p> <p><img src="/W2022/assets/img/aws-ecs-step-6.97d84700.png" alt="ECS configuration step 6"></p> <p>Set the <strong>Task Definition Name</strong> to <code>giftr-api-task</code> then scroll down to the <em>Task size</em> section.</p> <p><img src="/W2022/assets/img/aws-ecs-step-7.bb3421d3.png" alt="ECS configuration step 7"></p> <p>Set the <strong>Task memory (GB)</strong> to <code>0.5GB</code>.
Set the <strong>Task CPU (vCPU)</strong> to <code>0.25 vCPU</code>.
Click the blue <strong>Add container</strong> button.
<img src="/W2022/assets/img/aws-ecs-step-8.19afe33d.png" alt="ECS configuration step 8"></p> <h5 id="container-definition"><a href="#container-definition" class="header-anchor">#</a> Container Definition</h5> <p><img src="/W2022/assets/img/aws-ecs-step-9.850e46d2.png" alt="ECS configuration step 9"></p> <p>Set these settings in the <strong>Standard</strong> section of the configuration form:</p> <ul><li>Container name: <code>giftr-api-w21</code></li> <li>Image: <code>&lt;Docker-Hub-username&gt;/giftr-api-w21</code></li> <li>Soft limit: <code>300</code></li> <li>Port mapping: <code>80</code></li></ul> <p>Scroll down to the <strong>Environment Variables</strong> section.
<img src="/W2022/assets/img/aws-ecs-step-10.b4911e15.png" alt="ECS configuration step 10"></p> <p>Add the following <em>key=value</em> pairs:</p> <ul><li>NODE_ENV = <code>stage</code></li> <li>API_PORT = <code>80</code></li> <li>API_JWTKEY = <code>&lt;your-secret-random-key&gt;</code></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Use the <code>genKey.js</code> script from week 11 to generate a new random key.</p></div> <p>Click the blue <strong>Add</strong> button in the bottom right corner. This will create the Container Definition and close the slide-over panel.</p> <p>Now, scroll all the way to the bottom and click the blue <strong>Create</strong> button in the bottom right corner to complete the Task Definition.</p> <p><img src="/W2022/assets/img/aws-ecs-step-11.bc0c488a.png" alt="ECS configuration step 11"></p> <h5 id="service-definition"><a href="#service-definition" class="header-anchor">#</a> Service Definition</h5> <p>In the left-hand menu choose <strong>Clusters</strong> again. Click the orange <strong>Deploy</strong> button.
<img src="/W2022/assets/img/aws-ecs-step-12.c8a556a1.png" alt="ECS configuration step 12">
In the <strong>Environment</strong> section choose your <strong>Existing cluster</strong>: <code>mad9124</code>.</p> <p>Set application type to <strong>Service</strong></p> <p>The task definition <strong>Family</strong> should be <code>giftr-api-task</code> with revision as <code>LATEST</code>.</p> <p>Give the service a name of <code>giftr-api-service</code>, and set the desired number of tasks at <code>2</code>.
<img src="/W2022/assets/img/aws-ecs-step-13.483a909b.png" alt="ECS configuration step 13"></p> <p>Scroll down a little to setup the <strong>Load Balancing</strong> options. Create a <strong>new</strong> <code>Application Load Balancer</code> and call it <code>giftr-api-elb</code>.</p> <p>Set it to listen on port <code>80</code> with protocol <code>http</code>.</p> <p>Set the <strong>Target group name</strong> to <code>giftr-api-ecs-target-group</code> and the protocol to <code>http</code>.</p> <p>Now click the orange <strong>Deploy</strong> button.
<img src="/W2022/assets/img/aws-ecs-step-14.aae53a3a.png" alt="ECS configuration step 14"></p> <p>Notice the blue banner message at the top of the next screen.
<img src="/W2022/assets/img/aws-ecs-step-15.5c9d3a88.png" alt="ECS configuration step 15"></p> <p>After a few minutes all of the service infrastructure will be deployed and ready.
<img src="/W2022/assets/img/aws-ecs-step-16.a8aaea5c.png" alt="ECS configuration step 16"></p> <h5 id="open-the-firewall"><a href="#open-the-firewall" class="header-anchor">#</a> Open the firewall</h5> <p>One last step. You need to open the firewall on your virtual network to allow incoming HTTP traffic from Postman or your browser client application.</p> <p>This is controlled in another part of the AWS console. From the <strong>Services</strong> menu at the top of the screen, choose <strong>EC2</strong> in the Compute section.</p> <p>The <strong>Resources</strong> panel in the middle of the screen shows several options. Click on the one called <strong>Security Groups</strong>.</p> <p><img src="/W2022/assets/img/aws-ecs-step-17.6a5fa157.png" alt="ECS configuration step 17"></p> <p>You will hav on one default security group. Select it in the top half of the screen, and then click the <strong>Inbound rules</strong> tab in the lower half of the screen.</p> <p><img src="/W2022/assets/img/aws-ecs-step-18.239e2407.png" alt="ECS configuration step 18"></p> <p>Click the <strong>Edit inbound rules</strong> button.
<img src="/W2022/assets/img/aws-ecs-step-19.7d8a6c40.png" alt="ECS configuration step 19"></p> <p>Now click the <strong>Add rule</strong> button. Select <strong>HTTP</strong> from the type drop-down list. Select <strong>Anywhere</strong> from the source drop-down list.
<img src="/W2022/assets/img/aws-ecs-step-20.ec87ce70.png" alt="ECS configuration step 20"> <img src="/W2022/assets/img/aws-ecs-step-21.78fd5dbf.png" alt="ECS configuration step 21"></p> <p>Click the orange <strong>Save rules</strong> button.
<img src="/W2022/assets/img/aws-ecs-step-22.67f07ea5.png" alt="ECS configuration step 22"></p> <p><strong>WOOO HOOOO! You have launched your first AWS CloudFormation Stack!</strong></p> <h4 id="_4-test-with-load-balancer-address-with-postman"><a href="#_4-test-with-load-balancer-address-with-postman" class="header-anchor">#</a> 4. Test with Load Balancer address with Postman</h4> <p>So, now we should run some Postman test. But what is the URL?</p> <p>In the ECS service definition, we created an application load balancer. This will be the &quot;front door&quot; URL for your API service cluster.</p> <p>To find the load balancer's public DNS name, we need to go to the EC2 Console section of AWS.</p> <p>Click on the <strong>Services</strong> top menu drop-down and then select <strong>EC2</strong> from the top of the <em>Compute</em> service list.
<img src="/W2022/assets/img/aws-navigate-ec2.8fac0c20.png" alt="Navigate to EC2"></p> <p>This will take you to the main EC2 Dashboard. Select <strong>Load Balancers</strong> from the Resource options in the middle of the page.
<img src="/W2022/assets/img/aws-ec2-dashboard.7d29c3d2.png" alt="EC2 dashboard"></p> <p>You will now see the list of active load balancers on your AWS Classroom account. There should only be one at this point. Click the check box next to the name of your load balancer to see the details at the bottom of the screen.
<img src="/W2022/assets/img/aws-load-balancer-details.a2d5cc62.png" alt="EC2 load balancer details"></p> <p>Copy the <strong>DNS name</strong> and use that as the hostname for your Postman tests.</p> <h4 id="_5-link-to-load-balancer-in-client-app"><a href="#_5-link-to-load-balancer-in-client-app" class="header-anchor">#</a> 5. Link to Load Balancer in client app.</h4> <p>In a real app, you could now use this URL in the <code>fetch</code> code of your frontend client application.</p> <p>You would also want to turn on HTTPS for the load balancer, or your browser will block access to &quot;mixed content requests&quot;. At the moment, the AWS Classroom accounts don't have access to the AWS Certificate Manager Service, so we cannot do this right now.</p> <h3 id="congratulations"><a href="#congratulations" class="header-anchor">#</a> Congratulations!</h3> <p>You have successfully deployed a load balanced redundant API web service container cluster connected to a separate redundant database cluster — all hosted on Amazon Web Services.</p> <h2 id="for-additional-resources"><a href="#for-additional-resources" class="header-anchor">#</a> For additional resources</h2> <p>The procedure above is an excellent introduction to containers and AWS. This can be a great talking point in a job interview, but there is more to learn. Please review these additional online resources.</p> <ul><li><p><a href="https://aws.amazon.com/ecs/" target="_blank" rel="noopener noreferrer">Amazon Elastic Container Service<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://aws.amazon.com/fargate" target="_blank" rel="noopener noreferrer">AWS Fargate<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://aws.amazon.com/vpc/" target="_blank" rel="noopener noreferrer">Amazon Virtual Private Cloud<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://aws.amazon.com/elasticloadbalancing" target="_blank" rel="noopener noreferrer">Amazon Elastic Load Balancing<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://docs.docker.com/engine/docker-overview/" target="_blank" rel="noopener noreferrer">Docker overview<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://www.youtube.com/watch?v=YFl2mCHdv24" target="_blank" rel="noopener noreferrer">Learn Docker in 12 Minutes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><a href="https://www.youtube.com/watch?v=Qw9zlE3t8Ko" target="_blank" rel="noopener noreferrer">Docker Compose in 12 Minutes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/27/2022, 9:01:40 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/W2022/modules/week13/" class="prev">
        Week 13: Testing
      </a></span> <span class="next"><a href="/W2022/modules/week15/">
        Week 15: Final Lab
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/W2022/assets/js/app.cec51691.js" defer></script><script src="/W2022/assets/js/3.9c2ff4f7.js" defer></script><script src="/W2022/assets/js/2.b4d63df3.js" defer></script><script src="/W2022/assets/js/11.f11acbbb.js" defer></script>
  </body>
</html>
